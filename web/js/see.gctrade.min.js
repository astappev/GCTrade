var user={online:[],update:function(){$(".table > tbody > tr").each(function(a){var b=this;setTimeout(function(){var c=$("td",b).eq(0).text();$.ajax({url:"https://api.greencubes.org/users/"+c,type:"GET",dataType:"json",success:function(g){if(g.status.main){if(!user.online[c]){var d=$("td",b).eq(1).text();var f="Пользователь "+c+", зашел поиграть!";new Notification(f,{tag:"gc-see",body:d,icon:"/images/see.png"});user.online[c]=true}$("td",b).eq(2).html('<span class="label label-info">В сети</span>')}else{if(user.online[c]){online[c]=false}var e=(new Date(g.lastseen.main*1000)).toGMTString();var h=(Math.round(+new Date()/1000)-g.lastseen.main)/60;if(h>30240){$("td",b).eq(2).html('<span class="label label-success" rel="tooltip" data-placement="top" title="'+e+'">Неактивен</span></li>')}else{$("td",b).eq(2).html('<span class="label label-default" rel="tooltip" data-placement="top" title="'+e+'">'+jQuery.timeago(g.lastseen.main*1000)+"</span></li>")}}},error:function(){alert("Невозможно получить информацию о пользователе.")}})},100*a)});return this}};$("button#delete").click(function(){var a=$(this).parents("tr");var b=$(a).attr("id");$.ajax({url:"/see/delete",type:"GET",data:{id:b},success:function(){$(a).fadeOut(300,function(){$(this).remove()})},error:function(){alert("Ошибка при удалении пользователя.")}})});$("#permission").click(function(){$(".alert").removeClass("visible").addClass("hidden");if(Notification.permission==="default"){Notification.requestPermission(function(a){if(!("permission" in Notification)){Notification.permission=a}if(a==="granted"){new Notification("Спасибо!",{lang:"ru-RU",body:"Теперь мы можем посылать вам уведомления, когда пользователь зайдет поиграть."})}})}});$(document).ready(function(){$(".table > tbody td.status").spin("show");if(!("Notification" in window)){alert("Ваш браузер не поддерживает HTML5 Notifications")}else{if(Notification.permission==="granted"){console.log("С уведомлениями все впорядке.")}else{$(".alert").removeClass("hidden").addClass("visible")}}user.update();setInterval(function(){user.update()},180000)});
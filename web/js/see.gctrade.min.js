function lastseen(e){var t=$.ajax({url:"/see/lastseen",type:"GET",cache:!1,async:!1,data:{login:e}}).responseText;return time(t)}function update_world(){online=[];var e=$.parseJSON($.ajax({type:"GET",url:"/api/world",async:!1,dataType:"json"}).responseText);for(var t in e)online.push(e.name);online.length>0?$(".alert").hide():($(".alert").show(),$(".alert").alert()),console.log("Кол-во игроков онлайн: "+online.length)}function isonline(e){for(var t=0;t<online.length;t++)if(online[t]==e)return!0;return!1}function time(e){var t=new Date(1e3*e),n=t.toGMTString(),a=Math.round(+new Date/1e3),i=(a-e)/60,o="def";return i>30240?'<span class="label label-success" rel="tooltip" data-placement="top" title="'+n+'">Неактивен</span></li>':(o=i>5760?Math.round(i/1440)+" дней назад":i>2880?Math.round(i/1440)+" дня назад":i>1440?"Вчера":i>240?Math.round(i/60)+" часов назад":i>120?Math.round(i/60)+" часа назад":i>60?"Час назад":61>i?"Менее часа назад":"Не определено",'<span class="label label-default" rel="tooltip" data-placement="top" title="'+n+'">'+o+"</span></li>")}var online=new Array;$("button#delete").click(function(){var e=$(this).parents("tr"),t=$(e).attr("id");$.ajax({url:"/see/delete",type:"GET",data:{id:t},async:!1,success:function(){$(e).fadeOut(300,function(){$(this).remove()})},error:function(){alert("Ошибка удаления.")}})}),$(document).ready(function(){$(".table > tbody td.status").spin("show"),"Notification"in window?"granted"===Notification.permission?console.log("С уведомлениями все нормально."):$(".alert").removeClass("hidden").addClass("visible"):alert("Ваш браузер не поддерживает HTML5 Notifications"),$("#permission").click(function(){$(".alert").removeClass("visible").addClass("hidden"),"default"===Notification.permission&&Notification.requestPermission(function(e){if("permission"in Notification||(Notification.permission=e),"granted"===e){new Notification("Спасибо!",{lang:"ru-RU",body:"Теперь вы сможете получать уведомления."})}})}),update_world(),setTimeout(function(){$(".table > tbody > tr").each(function(e){{var t=this;setTimeout(function(){var e=$("td",t).eq(0).text();if(isonline(e)){var n='<span class="label label-info">В сети</span>',a=$("td",t).eq(1).text(),i=e+" сейчас в сети!";new Notification(i,{tag:"gc-see",body:a,icon:"/images/see.png"})}else var n=lastseen(e);$("td",t).eq(2).html(n)},100*e)}})},1e3),setInterval(function(){update_world(),setTimeout(function(){$(".table > tbody > tr").each(function(e){{var t=this;setTimeout(function(){var e=$("td",t).eq(2).html();$("td",t).eq(2).spin("show");var n=$("td",t).eq(0).text(),a=isonline(n);if(1==a&&'<span class="label label-info">В сети</span>'==e)e='<span class="label label-info">В сети</span>';else if(1==a){e='<span class="label label-info">В сети</span>';{var i=$("td",t).eq(1).text(),o=n+" сейчас в сети!";new Notification(o,{tag:"gc-see",body:i,icon:"/images/see.png"})}}else'<span class="label label-info">В сети</span>'==e&&(e='<strong class="label label-default">Совсем недавно</strong>');$("td",t).eq(2).html(e)},500*e)}})},1e3)},18e4)});

var isClear=!1,isSave=!1,shop_id=$("div.body-content.edit-shop").attr("id");$("#InputFile").change(function(t){isClear&&($("table#ImportItemFile tbody").empty(),isClear=!1);var e=$(this).val().split(".").pop().toLowerCase();if(-1==$.inArray(e,["csv","txt"]))return $("table#ImportItemFile").before('<p id="ErrorType">Загружаемый файл должен быть типа CSV или TXT</p>'),!1;if(void 0!=t.target.files){var a=new FileReader;a.onload=function(t){var e=t.target.result.split("\n");$("table#ImportItemFile").show();for(var a=0;a<e.length;a++){e[a]=$.trim(e[a]),";"==e[a].slice(-1)&&(e[a]=e[a].substring(0,e[a].length-1));var i=e[a].split(/,|;/);if(4==i.length){for(var l='<tr id="'+i[0]+'">',d=0;d<i.length;d++){var o=i[d].replace(/\s/g,"");"null"==o&&(o="—"),l+=0==d?'<td><img src="/images/items/'+o+'.png" class="small-icon"/></td>':"<td>"+o+"</td>"}l+='<td id="sp"></td></tr>',$("table#ImportItemFile tbody").append(l)}}},a.readAsText(t.target.files.item(0))}return!1}),$("form#AddItemForm").submit(function(t){isClear&&($("table#AddItemTable tbody").empty(),isClear=!1);var e=$("input#InputID").val().replace(",","."),a=$("input#InputBuy").val(),i=$("input#InputSell").val(),l=$("input#InputStuck").val();if(e&&l&&(a||i)){a||(a="—"),i||(i="—"),$("table#AddItemTable").show();var d='<tr id="'+e+'"><td><img src="/images/items/'+e+'.png" class="small-icon"/></td><td>'+a+"</td><td>"+i+"</td><td>"+l+'</td><td id="sp"></td></tr>';$("table#AddItemTable tbody").append(d),$("form#AddItemForm").trigger("reset")}t.preventDefault()}),$("button#sync").click(function(){isClear=!0;var t=$("table.AddItem:visible > tbody");$("td#sp",t).spin("show"),setTimeout(function(){$("tr",t).each(function(t){{var e=this;setTimeout(function(){var t=$(e).attr("id"),a=$("td",e).eq(1).text(),i=$("td",e).eq(2).text(),l=$("td",e).eq(3).text();isNaN(a)&&(a=0),isNaN(i)&&(i=0),console.log(a+":"+i);var d=$.ajax({type:"GET",url:"/shop/cpanel/item-edit",cache:!1,async:!1,dataType:"json",data:{shop_id:shop_id,item_id:t,price_sell:a,price_buy:i,stuck:l}}).responseText;d=$.parseJSON(d),$("td",e).eq(4).html('<span class="glyphicon glyphicon-'+(0!=d.status?1==d.status?"refresh blue":"ok-circle green":"ban-circle red")+' twosize" data-toggle="tooltip" title="'+d.message+'"></span>')},100*t)}})},300),isSave=!0});var that;$("button#editButtons").click(function(){that=$(this).parents("tr"),$("#EditModal").modal("show");var t=$("td",that).eq(1).text(),e=$("td",that).eq(2).text(),a=$("td",that).eq(3).text(),i=$("td",that).eq(4).text(),l=$("td",that).eq(5).text();isNaN(a)&&(a=null),isNaN(i)&&(i=null),$(".modal#EditModal label#name").html('<img class="small-icon" src="/images/items/'+t+'.png" alt="'+e+'">'),$(".modal#EditModal p#name").text(e+" ("+t+")"),$(".modal#EditModal #IdHide").val(t),$(".modal#EditModal #Sell").val(a),$(".modal#EditModal #Buy").val(i),$(".modal#EditModal #Stuck").val(l)}),$(".modal#EditModal button#editButtonModal").click(function(t){var e=$("form#EditItemForm"),a=$("#IdHide",e).val(),i=$("#Sell",e).val(),l=$("#Buy",e).val(),d=$("#Stuck",e).val();$.ajax({type:"GET",url:"/shop/cpanel/item-edit",cache:!1,async:!1,data:{item_id:a,shop_id:shop_id,price_sell:i,price_buy:l,stuck:d},success:function(){$("#EditModal").modal("hide"),i||(i="—"),l||(l="—"),$("td",that).eq(3).text(i),$("td",that).eq(4).text(l),$("td",that).eq(5).text(d)}}),t.preventDefault()}),$("#AddModal").on("hidden.bs.modal",function(){$("table#AddItemTable tbody").empty(),$("table#AddItemTable").hide(),isSave&&location.reload(),isClear=!1}),$("#ImportFileModal").on("hidden.bs.modal",function(){$("table#ImportItemFile tbody").empty(),$("table#ImportItemFile").hide(),$("#ErrorType").remove(),isSave&&location.reload(),isClear=!1}),$("button#removeButtons").click(function(){that=$(this).parents("tr");var t=$("td",that).eq(1).text();$.get("/shop/cpanel/item-remove",{shop_id:shop_id,item_id:t}).done(function(){$(that).hide("slow",function(){$(that).remove()})})});

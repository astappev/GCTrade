var isClear=!1,isSave=!1,id_shop=$("div.body-content.edit-shop").attr("id");$("#InputFile").change(function(t){isClear&&($("table#ImportItemFile tbody").empty(),isClear=!1);var e=$(this).val().split(".").pop().toLowerCase();if(-1==$.inArray(e,["csv","txt"]))return $("table#ImportItemFile").before('<p id="ErrorType">Загружаемый файл должен быть типа CSV или TXT</p>'),!1;if(void 0!=t.target.files){var a=new FileReader;a.onload=function(t){var e=t.target.result.split("\n");$("table#ImportItemFile").show();for(var a=0;a<e.length;a++){e[a]=$.trim(e[a]),";"==e[a].slice(-1)&&(e[a]=e[a].substring(0,e[a].length-1));var i=e[a].split(/,|;/);if(4==i.length){for(var d='<tr id="'+i[0]+'">',l=0;l<i.length;l++){var o=i[l].replace(/\s/g,"");"null"==o&&(o="—"),d+=0==l?'<td><img src="/images/items/'+o+'.png" class="small-icon"/></td>':"<td>"+o+"</td>"}d+='<td id="sp"></td></tr>',$("table#ImportItemFile tbody").append(d)}}},a.readAsText(t.target.files.item(0))}return!1}),$("form#AddItemForm").submit(function(t){isClear&&($("table#AddItemTable tbody").empty(),isClear=!1);var e=$("input#InputID").val(),a=$("input#InputBuy").val(),i=$("input#InputSell").val(),d=$("input#InputStuck").val();if(e&&d&&(a||i)){a||(a="—"),i||(i="—"),$("table#AddItemTable").show();var l='<tr id="'+e+'"><td><img src="/images/items/'+e+'.png" class="small-icon"/></td><td>'+a+"</td><td>"+i+"</td><td>"+d+'</td><td id="sp"></td></tr>';$("table#AddItemTable tbody").append(l),$("form#AddItemForm").trigger("reset")}t.preventDefault()}),$("button#sync").click(function(){isClear=!0;var t=$("table.AddItem:visible > tbody");$("td#sp",t).spin("show"),setTimeout(function(){$("tr",t).each(function(t){{var e=this;setTimeout(function(){var t=$(e).attr("id"),a=$("td",e).eq(1).text(),i=$("td",e).eq(2).text(),d=$("td",e).eq(3).text();isNaN(a)&&(a=null),isNaN(i)&&(i=null),console.log(a+":"+i);var l=$.ajax({type:"GET",url:"/shop/edititem",cache:!1,async:!1,data:{id_shop:id_shop,id_item:t,price_sell:a,price_buy:i,stuck:d}}).responseText;$("td",e).eq(4).html(l)},100*t)}})},300),isSave=!0});var that;$("button#editButtons").click(function(){that=$(this).parents("tr"),$("#EditModal").modal("show");var t=$("td",that).eq(1).text(),e=$("td",that).eq(2).text(),a=$("td",that).eq(3).text(),i=$("td",that).eq(5).text(),d=$("td",that).eq(7).text();isNaN(a)&&(a=null),isNaN(i)&&(i=null),$(".modal#EditModal label#name").html('<img class="small-icon" src="/images/items/'+t+'.png" alt="'+e+'">'),$(".modal#EditModal p#name").text(e+" ("+t+")"),$(".modal#EditModal #IdHide").val(t),$(".modal#EditModal #Sell").val(a),$(".modal#EditModal #Buy").val(i),$(".modal#EditModal #Stuck").val(d)}),$(".modal#EditModal button#editButtonModal").click(function(t){var e=$("form#EditItemForm"),a=$("#IdHide",e).val(),i=$("#Sell",e).val(),d=$("#Buy",e).val(),l=$("#Stuck",e).val();$.ajax({type:"GET",url:"/shop/edititem",cache:!1,async:!1,data:{id_item:a,id_shop:id_shop,price_sell:i,price_buy:d,stuck:l},success:function(){$("#EditModal").modal("hide"),i||(i="—"),d||(d="—"),$("td",that).eq(3).text(i),$("td",that).eq(5).text(d),$("td",that).eq(7).text(l)}}),t.preventDefault()}),$("#AddModal").on("hidden.bs.modal",function(){$("table#AddItemTable tbody").empty(),$("table#AddItemTable").hide(),isSave&&location.reload(),isClear=!1}),$("#ImportFileModal").on("hidden.bs.modal",function(){$("table#ImportItemFile tbody").empty(),$("table#ImportItemFile").hide(),$("#ErrorType").remove(),isSave&&location.reload(),isClear=!1}),$("button#removeButtons").click(function(){that=$(this).parents("tr");var t=$("td",that).eq(1).text();$.get("/shop/removeitem",{id_shop:id_shop,id_item:t}).done(function(){$(that).hide("slow",function(){$(that).remove()})})});
